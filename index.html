<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://rawgit.com/schmich/instascan-builds/master/instascan.min.js"></script>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="style.css" type="text/css" media="all" />

    <title>Document</title>
  </head>
  <body>
    <!-- Image and text -->
<nav class="navbar " style ="justify-content: flex-start;">
  <a class="navbar-brand" href="#" style="padding-top:0rem ;">
    <img src="logo.png" width="90" height="35" class="d-inline-block align-left" style ="margin-left: 20px; padding-top:0 ;"alt="">
  </a>
    <span style = "color: rgb(238, 230, 221);"></span>
  </a>
</nav>
      <center>
        
      </center>
      <center>
        <div>
          <video id="preview" width="550" height="400"></video><br>
          <b style="color:rgb(240, 224, 224) ;">Do you have your ID with you?</b>
          <input type="checkbox" name="ID" value="IDtrue" class = "idyes">
         </div>
         <br>
        <button type="button" class="btn btn" id="test" disabled>
          Download Your Data!
        </button>
        
      </center>
      
      <br />
    </div>
    <center>
      <div>
        <table
          class="table table-dark table-hover table-bordered table-responsive-sm table-striped"
          style="width: 50%"
          id="table"
        >
          <thead id="head" class="table-responsive">
            <tr id="rowheads">
              <th scope="col" style="width: 5%">S.No</th>
              <th scope="col" style="width: 20%">Roll Number</th>
              <th scope="col" style="width: 30%">Email Id</th>
              <th scope="col" style="width: 10%">Department</th>
              <th scope="col" style="width: 10%">Year</th>
            </tr>
          </thead>
          <tbody id="body"></tbody>
        </table>
      </div>
    </center>

    <script type="text/javascript">
      let scanner = new Instascan.Scanner({
        video: document.getElementById("preview"),
      });
      scanner.addListener("scan", con);
      Instascan.Camera.getCameras()
        .then(function (cameras) {
          if (cameras.length > 0) {
            scanner.start(cameras[0]);
          } else {
            console.error("No cameras found.");
          }
        })
        .catch(function (e) {
          console.error(e);
        });
      let count = 0;
      let arr = [];

      function con(content) {
        alert(content)
        if (!arr.includes(content)) {
          arr.push(content);
          console.log(arr);
          let tbody = document.getElementById("body");
          let tablerow = document.createElement("tr");
          let thead = document.createElement("th");
          let newdata = document.createElement("td");
          let email = document.createElement("td");
          let year = document.createElement("td");
          downloadbutton = document.getElementById("test");
          downloadbutton.disabled = false;
          let Department = document.createElement("td");
          const dept = function any(d) {
            if (d === "03") return "CSE";
            if (d === "08") return "AI&DS";
            if (d === "04") return "ECE";
          };

          const yearofstudy = () => {
            let yearofjoin ="Y" + content.slice(0, 2);
            return yearofjoin;
            
          };

          Department.innerText = `${dept(content.slice(4, 6))}`;
          email.innerText = `${content}@klh.edu.in`;
          year.innerText = `${yearofstudy()}`;
          newdata.innerText = content;
          count = count + 1;
          thead.innerText = count;
          tbody.appendChild(tablerow);
          tablerow.appendChild(thead);
          tablerow.appendChild(newdata);
          tablerow.appendChild(email);
          tablerow.appendChild(Department);
          tablerow.appendChild(year);
          console.log(yearofstudy());
          alert("Success!");
        } else {
          alert("Already Entered Value");
        }
      }

      function download_txt() {
        var textToSave = document.getElementById("body").innerText;
        var titles = document.getElementById("rowheads").innerText;
        var hiddenElement = document.createElement("a");
        hiddenElement.href = "data:attachment/text," + encodeURI(textToSave);
        hiddenElement.target = "_blank";
        hiddenElement.download = "Event_Data.txt";
        hiddenElement.click();
      }

      document.getElementById("test").addEventListener("click", download_txt);
    </script>
  </body>
</html>
